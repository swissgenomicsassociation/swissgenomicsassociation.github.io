<div id="main-menu" class="main-menu">
  {% assign menu = site.data.menus.main | sort: "weight" %}
  {% assign lang = page.lang | default: site.lang | default: "en" %}

  <ul>
  {% for item in menu %}

    {% assign clean = item.url | replace: "//", "/" %}
    {% assign clean = clean | remove_first: "/" %}
    {% if clean != "" and clean != nil %}
      {% assign clean = clean | append: "/" %}
      {% assign clean = clean | replace: "//", "/" %}
    {% endif %}

    {% if clean == "" or clean == "/" or clean == nil %}
      {% if lang == "en" %}
        {% assign href = "/" %}
      {% else %}
        {% assign href = "/" | append: lang | append: "/" %}
      {% endif %}
    {% else %}
      {% if lang == "en" %}
        {% assign href = "/" | append: clean %}
      {% else %}
        {% assign href = "/" | append: lang | append: "/" | append: clean %}
      {% endif %}
    {% endif %}

    {% assign href = href | replace: "//", "/" %}

    <li class="{% if href == page.url %}active{% endif %}">
      <a href="{{ href | relative_url }}">{{ item.name[lang] | default: item.name.en }}</a>
    </li>

  {% endfor %}
  </ul>
</div>

